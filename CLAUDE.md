# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 一般的な開発ガイドライン

### 日本語と英語の使い分け
- ユーザーとのやり取り（説明、質問への回答など）: 日本語
- Claude Code 上での分析結果、計画、進捗報告: 日本語
- プランモードでの計画案: 日本語
- エラーメッセージの説明、デバッグ情報: 日本語
- TodoWriteツールのチェックリスト項目: 日本語
- コードのコメント: 英語
- コミットメッセージ: 英語
- PRタイトル・本文: 英語
- ドキュメント（README等）: 英語

### READMEの多言語対応ルール
- **見出しはすべて英語で統一**: すべての言語版のREADME（README.md、README.[言語コード].md）で、セクション見出し（##で始まる部分）は英語表記とする
- **目的**: URLのアンカーリンク（#installation など）を言語間で統一し、リンクの互換性を保つ
- **例**:
  - ✅ `## Installation` （すべての言語版で統一）
  - ❌ `## [その言語での翻訳]` （翻訳版でも使わない）

### コードの品質
- **型安全性**: TypeScriptの型安全を最優先
- **コードの可読性**: コメントやドキュメントを充実させる
- **テストの充実**: ユニットテスト、統合テストを必ず実装
- **エラー修正時のコメント**: エラーが発生した箇所や修正が必要だった箇所には、なぜそのエラーが起きたのか、どう修正したのかを説明するコメントを積極的に残す

### 実装方針
- **仕様の確認**: 実装前に必ずREADMEを熟読し、プロジェクトの仕様を理解する
- **YAGNI原則**: "You Aren't Gonna Need It" - 将来使うかもしれない機能や関数は作らない
- **未使用コードの防止**: 実際に使用されるコードのみを実装し、未使用の関数やクラスは作成しない
- **リファクタリング**: 綺麗なアーキテクチャを採用し、不要なコードは積極的に削除
- **CI実行**: 実装後は必ず `bun run ci` でコード品質を確認する
- **後方互換性を持たせない**: 利用者が少ない今のうちに、破壊的変更を積極的に許容し、後方互換性を一切持たせない
  - APIの変更、関数名の変更、ディレクトリ構造の変更などを躊躇なく実施
  - 古いコードとの互換性維持のための冗長なコードは作らない
- **積極的なリファクタリング**: 綺麗なアーキテクチャを追求し、継続的にコードを改善
  - 不要なコード、重複したコード、複雑すぎるコードは即座に削除・簡潔化
  - より良い設計パターンが見つかれば、既存の実装を躊躇なく置き換える
- **ライブラリの最新版使用**: 新しいライブラリをインストールする際は、必ず最新版を使用する
  - npm/yarn/bun でパッケージをインストールする際は、バージョンを指定せずに最新版をインストール
  - 例: `bun add package-name` （`@version` を付けない）
  - セキュリティとパフォーマンスの観点から、常に最新の安定版を使用することを推奨

### テストの方針
- **カバレッジより意味のあるテスト**: カバレッジ率を追求するのではなく、本当に価値のあるテストのみを実装
  - 100%カバレッジは目標ではない
  - 無意味なテスト（getter/setterのテスト、定数のテストなど）は書かない
  - 重要な振る舞いと境界値に焦点を当てる
- **テストランナー**: テストコードはbunで動作するように実装する（`bun test`コマンドで実行）
- **統合テスト優先**: リファクタリングを頻繁に行うため、内部実装に依存しない統合テストを優先
- **ユニットテストの削減**: 統合テストでカバーされている機能のユニットテストは積極的に削除
- **無駄なテストの例**:
  - 単純なgetter/setterのテスト
  - 型定義や定数の値を確認するだけのテスト
  - フレームワークの機能を再テストするようなテスト
  - 実装の詳細に依存しすぎているテスト
- **テスト失敗時の対応**: テストが失敗した場合、まずそのテスト自体の価値を検討する
  - そのテストは本当に必要か？
  - 統合テストでカバーできないか？
  - テストの削除も重要な選択肢として検討する
- **内部実装への依存を避ける**: 
  - 内部実装の詳細をテストしない（プライベートメソッド、内部状態など）
  - リファクタリング時に修正が必要なテストは作らない
  - 振る舞い（入力と出力）のみをテストする
- **モックの使用を避ける**: 可能な限り実際の実装を使用し、環境差異を生まないテストを書く
  - 外部API呼び出しなど、真にモックが必要な場合のみ使用
  - ユーティリティ関数（logger等）は実際の実装を使用し、オプション（quiet等）で制御
- **エッジケースに集中**: ユニットテストは統合テストでカバーしにくいエラーケースやエッジケースのみ
- **環境依存テストの削除**: パーミッションエラーなど環境に依存するテストは避ける
- **実装の見直し**: テストが複雑になる場合は、まず実装をシンプルにできないか検討する

### TypeScript実装前の型安全確認
- **必ず最初に**: tsconfig.json の型安全制御設定を確認
- **型安全性は最高レベル**: `strict: true`により`noImplicitAny`を含むすべての厳格な型チェックが有効
- **よくある間違い**: エクスポートする関数・クラスの戻り値型や引数型の明示的な型注釈を忘れがち

### Git操作の制限
- **コミット禁止**: ユーザーから明示的に指示された場合のみコミットを実行する
- **プッシュ禁止**: ユーザーから明示的に指示された場合のみプッシュを実行する
- **ブランチ操作制限**: ブランチの作成・切り替え・削除もユーザーの明示的な指示が必要
- **自動コミットの防止**: 変更を加えた後も、ユーザーの指示がない限りコミットしない

## プロジェクト固有の設定

### CIスクリプトの実行
- **CIコマンド**: `bun run ci` でフォーマット→型チェック→リント→ビルド→テスト→未使用コード検出を順次実行
- **エラー処理**: 途中でエラーが発生した場合は詳細を日本語で説明し、修正提案を行う
- **未使用コード検出**: CIで未使用の関数やクラスが検出されるため、実際に使用されるコードのみを実装すること

### Requirements
- **Node.js**: v20 以上
- **bun**: 最新版
